---
alwaysApply: true
---
# Regla de Workflow de Testing - Siempre Aplicada

## ğŸ¯ Objetivo Principal
**Garantizar la calidad del cÃ³digo mediante testing exhaustivo y cobertura adecuada en cada implementaciÃ³n de funcionalidad.**

## ğŸ“‹ Reglas Obligatorias

### 1. **Testing Obligatorio en Cada ImplementaciÃ³n**
- âœ… **SIEMPRE** crear tests para nueva funcionalidad
- âœ… **SIEMPRE** actualizar tests existentes cuando se modifique cÃ³digo
- âœ… **NUNCA** implementar funcionalidad sin tests correspondientes
- âœ… **NUNCA** hacer commit de cÃ³digo sin tests

### 2. **EjecuciÃ³n de Tests Post-ImplementaciÃ³n**
- âœ… **OBLIGATORIO** ejecutar todos los tests del bundle trabajado
- âœ… **OBLIGATORIO** ejecutar tests de todas las clases implicadas
- âœ… **OBLIGATORIO** verificar que todos los tests pasen (0 fallos, 0 errores)
- âœ… **OBLIGATORIO** ejecutar tests antes de cada commit

### 3. **CorrecciÃ³n de Tests Fallidos**
- âœ… **SIEMPRE** corregir tests que fallen
- âœ… **SIEMPRE** re-ejecutar tests despuÃ©s de correcciones
- âœ… **NUNCA** dejar tests fallidos sin resolver
- âœ… **NUNCA** hacer commit con tests fallidos

### 4. **Cobertura de CÃ³digo**
- âœ… **OBJETIVO**: Cobertura cercana al 80%
- âœ… **MÃNIMO**: 70% de cobertura de cÃ³digo
- âœ… **IDEAL**: 80% o superior
- âœ… **MÃXIMO**: 95% (evitar over-testing)

## ğŸ”§ Comandos de Testing

### Ejecutar Tests del Bundle
```bash
# Tests completos del AutobizBundle
docker exec ao-local-development-symfony php bin/phpunit tests/AutobizBundle/

# Tests especÃ­ficos de una clase
docker exec ao-local-development-symfony php bin/phpunit tests/AutobizBundle/Application/Service/CreateAccountServiceTest.php

# Tests con cobertura
docker exec ao-local-development-symfony php bin/phpunit tests/AutobizBundle/ --coverage-html coverage/
```

### Verificar Cobertura
```bash
# Generar reporte de cobertura
docker exec ao-local-development-symfony php bin/phpunit tests/AutobizBundle/ --coverage-text

# Cobertura HTML (mÃ¡s detallada)
docker exec ao-local-development-symfony php bin/phpunit tests/AutobizBundle/ --coverage-html coverage/
```

## ğŸ“Š Niveles de Cobertura por Capa

### **Domain Layer** (Capa de Dominio)
- **Objetivo**: 100% de cobertura
- **RazÃ³n**: LÃ³gica crÃ­tica de negocio
- **Tests**: Unit tests exhaustivos

### **Application Layer** (Capa de AplicaciÃ³n)
- **Objetivo**: 95% de cobertura
- **RazÃ³n**: Casos de uso principales
- **Tests**: Unit tests + Integration tests

### **Infrastructure Layer** (Capa de Infraestructura)
- **Objetivo**: 90% de cobertura
- **RazÃ³n**: Adaptadores y servicios tÃ©cnicos
- **Tests**: Unit tests + Mock tests

### **Command Layer** (Capa de Comandos)
- **Objetivo**: 85% de cobertura
- **RazÃ³n**: Interfaz de usuario (CLI)
- **Tests**: Functional tests + Unit tests

## ğŸ§ª Tipos de Tests Requeridos

### **Unit Tests** (Obligatorios)
- âœ… Tests de cada mÃ©todo pÃºblico
- âœ… Tests de casos edge y excepciones
- âœ… Tests de validaciones
- âœ… Tests de lÃ³gica de negocio

### **Integration Tests** (Recomendados)
- âœ… Tests de flujos completos
- âœ… Tests de interacciÃ³n entre capas
- âœ… Tests de persistencia de datos

### **Functional Tests** (Para Comandos)
- âœ… Tests end-to-end de comandos
- âœ… Tests de opciones y argumentos
- âœ… Tests de salida y logging

## ğŸ“‹ Checklist de Testing

### **Antes de Implementar**
- [ ] Identificar clases que se van a modificar
- [ ] Revisar tests existentes
- [ ] Planificar nuevos tests necesarios

### **Durante la ImplementaciÃ³n**
- [ ] Escribir tests a la par del cÃ³digo
- [ ] Ejecutar tests frecuentemente
- [ ] Corregir tests que fallen

### **DespuÃ©s de Implementar**
- [ ] Ejecutar todos los tests del bundle
- [ ] Verificar cobertura de cÃ³digo
- [ ] Corregir cualquier test fallido
- [ ] Re-ejecutar tests hasta que pasen todos

### **Antes de Commit**
- [ ] Tests del bundle: âœ… PASAN
- [ ] Tests de clases implicadas: âœ… PASAN
- [ ] Cobertura de cÃ³digo: âœ… â‰¥70%
- [ ] 0 fallos, 0 errores: âœ… CONFIRMADO

## ğŸš¨ Reglas de Emergencia

### **Si Tests Fallan**
1. **NO hacer commit** hasta que pasen todos
2. **Analizar** el motivo del fallo
3. **Corregir** el cÃ³digo o el test segÃºn corresponda
4. **Re-ejecutar** tests hasta que pasen
5. **Verificar** cobertura antes de continuar

### **Si Cobertura es Baja**
1. **Identificar** cÃ³digo sin cobertura
2. **Escribir** tests para cÃ³digo crÃ­tico
3. **Priorizar** lÃ³gica de negocio
4. **Re-ejecutar** tests y verificar cobertura

## ğŸ“ˆ MÃ©tricas de Calidad

### **Tests Exitosos**
- âœ… **0 fallos** (failures)
- âœ… **0 errores** (errors)
- âœ… **0 warnings** (preferible)
- âœ… **Tiempo de ejecuciÃ³n** < 30 segundos

### **Cobertura de CÃ³digo**
- âœ… **LÃ­neas cubiertas**: â‰¥70%
- âœ… **MÃ©todos cubiertos**: â‰¥80%
- âœ… **Clases cubiertas**: â‰¥90%
- âœ… **Branches cubiertos**: â‰¥60%

## ğŸ”„ Flujo de Trabajo Obligatorio

### **1. ImplementaciÃ³n**
```bash
# 1. Implementar funcionalidad
# 2. Escribir/actualizar tests
# 3. Ejecutar tests localmente
docker exec ao-local-development-symfony php bin/phpunit tests/AutobizBundle/
```

### **2. VerificaciÃ³n**
```bash
# 4. Verificar cobertura
docker exec ao-local-development-symfony php bin/phpunit tests/AutobizBundle/ --coverage-text

# 5. Si hay fallos, corregir y re-ejecutar
# 6. Repetir hasta que todos los tests pasen
```

### **3. Commit**
```bash
# 7. Solo hacer commit si:
#    - Todos los tests pasen
#    - Cobertura â‰¥70%
#    - 0 fallos, 0 errores
```

## ğŸ”— IntegraciÃ³n con ChromaDB

### **Test Results Collection**
Los resultados de tests se pueden almacenar en `test_results_v1`:
- Resultados de tests unitarios e integraciÃ³n
- Cobertura de cÃ³digo
- Estado de tests (passed/failed)

### **Validation Evidence Collection**
La evidencia de validaciÃ³n se almacena en `validation_evidence_v1`:
- Transiciones de tests (test fallido â†’ test pasado)
- Verificaciones de soluciones
- Evidencia de correcciÃ³n de bugs

### **Uso en Workflow**
- Vincular tests con cÃ³digo en `codebase_v1`
- Usar resultados para validar cambios
- Promover patrones de testing exitosos a `derived_learnings_v1`

## âš ï¸ Excepciones (Muy Limitadas)

### **Solo se Permite Saltar Tests Si:**
- ğŸ”´ **Refactoring puro** (sin cambio de funcionalidad)
- ğŸ”´ **Cambios de documentaciÃ³n** Ãºnicamente
- ğŸ”´ **ConfiguraciÃ³n** de archivos no crÃ­ticos

### **NUNCA se Permite Saltar Tests Para:**
- âŒ Nueva funcionalidad
- âŒ ModificaciÃ³n de lÃ³gica de negocio
- âŒ Cambios en APIs
- âŒ ModificaciÃ³n de comandos
- âŒ Cambios en servicios

## ğŸ¯ Resumen de Reglas

1. **SIEMPRE** crear/actualizar tests con cada implementaciÃ³n
2. **SIEMPRE** ejecutar todos los tests del bundle despuÃ©s de implementar
3. **SIEMPRE** corregir tests fallidos antes de continuar
4. **SIEMPRE** buscar cobertura cercana al 80%
5. **NUNCA** hacer commit con tests fallidos
6. **NUNCA** implementar funcionalidad sin tests

**Esta regla se aplica SIEMPRE y es OBLIGATORIA para mantener la calidad del cÃ³digo.**
